<!DOCTYPE html>
<html>
<head>
    <title>Banner API Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #fff; }
        pre { background: #2a2a2a; padding: 15px; border-radius: 5px; overflow-x: auto; }
        .success { color: #4ade80; }
        .error { color: #f87171; }
        .warning { color: #fbbf24; }
        button { padding: 10px 20px; margin: 10px 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>üîç Banner API Ë®∫Êñ∑Â∑•ÂÖ∑</h1>
    
    <button onclick="testAPI()">Ê∏¨Ë©¶ API</button>
    <button onclick="testPermissions()">Ê∏¨Ë©¶Ê¨äÈôê</button>
    <button onclick="checkDatabase()">Ê™¢Êü•Ë≥áÊñô</button>
    
    <div id="output"></div>

    <script>
        const output = document.getElementById('output');
        
        function log(msg, type = 'info') {
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : type === 'warning' ? 'warning' : '';
            output.innerHTML += `<div class="${className}">${msg}</div>`;
        }
        
        function clear() {
            output.innerHTML = '';
        }

        async function testAPI() {
            clear();
            log('üì° Ê∏¨Ë©¶ Banner API...', 'info');
            
            try {
                const url = '/api/banners?populate=*&sort=sort_order:asc&filters[is_active][$eq]=true';
                log(`Request URL: ${url}`, 'info');
                
                const response = await fetch(url);
                log(`Response Status: ${response.status} ${response.statusText}`, 
                    response.ok ? 'success' : 'error');
                
                const data = await response.json();
                log(`Response Data:`, 'info');
                log(`<pre>${JSON.stringify(data, null, 2)}</pre>`, 'info');
                
                if (data.data && data.data.length > 0) {
                    log(`‚úÖ ÊàêÂäüÁç≤Âèñ ${data.data.length} Á≠Ü Banner Ë≥áÊñô`, 'success');
                    
                    data.data.forEach((item, index) => {
                        log(`Banner ${index + 1}:`, 'info');
                        log(`  - Title: ${item.attributes.title}`, 'info');
                        log(`  - Subtitle: ${item.attributes.subtitle}`, 'info');
                        log(`  - Active: ${item.attributes.is_active}`, 'info');
                        log(`  - Image URL: ${item.attributes.image_url || 'N/A'}`, 'info');
                    });
                } else {
                    log(`‚ö†Ô∏è API ÂõûÊáâÊàêÂäü‰ΩÜÊ≤íÊúâË≥áÊñô`, 'warning');
                }
            } catch (error) {
                log(`‚ùå API ÈåØË™§: ${error.message}`, 'error');
                log(`ÂèØËÉΩÂéüÂõ†:`, 'error');
                log(`1. Strapi ÂæåÂè∞Êú™ÈÅãË°å`, 'error');
                log(`2. API Ë∑ØÁî±Êú™ÈÖçÁΩÆ`, 'error');
                log(`3. Á∂≤Ë∑ØÈÄ£Êé•ÂïèÈ°å`, 'error');
            }
        }

        async function testPermissions() {
            clear();
            log('üîê Ê∏¨Ë©¶Ê¨äÈôê...', 'info');
            
            // Ê∏¨Ë©¶ÁÑ°ÂèÉÊï∏ÁöÑÂü∫Êú¨ API
            try {
                const response = await fetch('/api/banners');
                log(`Âü∫Êú¨ API Status: ${response.status}`, response.ok ? 'success' : 'error');
                
                if (response.status === 403) {
                    log(`‚ùå Ê¨äÈôêÈåØË™§ (403 Forbidden)`, 'error');
                    log(`Ë´ãÊ™¢Êü•: Settings > Roles > Public > BANNER > ‚úÖ find, findOne`, 'error');
                } else if (response.status === 404) {
                    log(`‚ùå API ‰∏çÂ≠òÂú® (404 Not Found)`, 'error');
                    log(`Ë´ãÊ™¢Êü• Banner API routes/controllers/services ÊòØÂê¶Â≠òÂú®`, 'error');
                } else if (response.ok) {
                    log(`‚úÖ Ê¨äÈôêÊ≠£Â∏∏`, 'success');
                }
            } catch (error) {
                log(`‚ùå ÈåØË™§: ${error.message}`, 'error');
            }
        }

        async function checkDatabase() {
            clear();
            log('üíæ Ê™¢Êü•Ë≥áÊñôÂ∫´ÁãÄÊÖã...', 'info');
            log('Ë´ãÂú® Strapi ÂæåÂè∞Ê™¢Êü•:', 'info');
            log('1. Content Manager ‚Üí Banner ‚Üí ÊòØÂê¶ÊúâË≥áÊñô?', 'info');
            log('2. Ë≥áÊñôÊòØÂê¶Â∑≤ÁôºÂ∏É (Published)?', 'info');
            log('3. is_active ÊòØÂê¶ÁÇ∫ TRUE?', 'info');
        }

        // Ëá™ÂãïÂü∑Ë°åÊ∏¨Ë©¶
        window.onload = () => {
            setTimeout(testAPI, 500);
        };
    </script>
</body>
</html>
